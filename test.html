<span style="background-color: rgb(255, 255, 255);"><!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Three.js draft</title>
<script src="Three.js"></script>
<script src="Controls/TrackballControls.js"></script>
<script src='Controls/DAT.GUI.min.js'></script>
<style type="text/css">
div#canvas-frame{
  border: none;
  cursor: pointer;
  width: 100%;
  height: 100%;
  background-color: #EEEEEE;
}
</style>
<script>
  var renderer;
  function initThree() {
    width = document.getElementById('canvas-frame').clientWidth;
    height = document.getElementById('canvas-frame').clientHeight; 
    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.shadowMapEnabled = true;
    renderer.setSize(width, height );
    var last = new Date().getTime();
    document.getElementById('canvas-frame').appendChild(renderer.domElement);
    renderer.setClearColorHex(0xFFFFFF, 1.0);
  }

  //////////////////////////////////////////////////////////////////////////////////
  //    Camera Controls                                                           //
  ////////////////////////////////////////////////////////////////////////////////// 
  var camera;
  function initCamera() { 
    camera = new THREE.PerspectiveCamera( 45 , width / height , 1 , 10000 );
    camera.position.x = 1000;
    camera.position.y = 0;
    camera.position.z = 0;
    camera.up.x = 0;
    camera.up.y = 0;
    camera.up.z = 1;
    camera.lookAt( {x:0, y:0, z:0 } );
 
    controls = new THREE.TrackballControls( camera );

        controls.rotateSpeed = 2.0;
        controls.zoomSpeed = 1.2;
        controls.panSpeed = 0.8;

        controls.noZoom = false;
        controls.noPan = false;

        controls.staticMoving = true;
        controls.dynamicDampingFactor = 0.3;

        controls.keys = [ 65, 83, 68 ];
      }


    
  var scene;
  function initScene() {   
    scene = new THREE.Scene();
    scene.updateMatrixWorld(true);
  }
  var light;


  function initLight() {
    light = new THREE.DirectionalLight(0xFFFFFF, 1.0, 0);
    light.position.set( 100, 100, 200 );
    light.castShadow = true;
    scene.add(light);
  }

 var Group = [];
 var sphere = [];
 var vector = [];
 function initObject(){  
    sphere[0] = new THREE.Mesh(
         new THREE.SphereGeometry(20,50,50),               
         new THREE.MeshLambertMaterial({color: 0xffff00}) 
          
    );
   vector[0] = new THREE.Vector3();

     sphere[1] = new THREE.Mesh(
         new THREE.SphereGeometry(20,50,50),               
         new THREE.MeshLambertMaterial({color: 0xff0000})

    );
   vector[1] = new THREE.Vector3();

     rx.push(0);
     ry.push(0);
     rz.push(0);
     sx.push(0);
     sy.push(0);
     sz.push(0);
    scene.add(sphere[0]);
    scene.add(sphere[1]);

    sphere[0].position.set(0,-18,0);
    sphere[1].position.set(0,18,0);
     scene.add(sphere[0]);
     scene.add(sphere[1]);

    
    dimer = new THREE.Object3D();
    dimer.add(sphere[0]);
    dimer.add(sphere[1]);
    dimer.position.set(0, 0, 0);
    Group.push(dimer);
    scene.add(Group[0]);

  }
      var k = 2;
      var kk = 1;
      var controlPanel = new function () {
        this.addDimers = function () {

            sphere[k] = new THREE.Mesh(
              new THREE.SphereGeometry(20,50,50),
              new THREE.MeshLambertMaterial({color: 0xffff00}) 
            );
            vector[k] = new THREE.Vector3();

            sphere[k + 1] = new THREE.Mesh(
              new THREE.SphereGeometry(20,50,50),
              new THREE.MeshLambertMaterial({color: 0xff0000})
            );
            vector[k + 1] = new THREE.Vector3();

            rx.push(0);
            ry.push(0);
            rz.push(0);
            sx.push(0);
            sy.push(0);
            sz.push(0);
    sphere[k].position.set(0,-18,0);
    sphere[k + 1].position.set(0,18,0);

            scene.add(sphere[k]);
            scene.add(sphere[k + 1]);

    dimer2 = new THREE.Object3D();
    dimer2.add(sphere[k]);
    dimer2.add(sphere[k + 1]);
    Group.push(dimer2);
    scene.add(Group[kk]);
    kk++;
    k += 2;
        }
      }


    var gui = new dat.GUI({width: 160});
    gui.add(controlPanel, 'addDimers');


  var rx = [];
  var ry = [];
  var rz = [];

  var sx = [];
  var sy = [];
  var sz = [];


  function collisionDetection( m, n){

          var mod = new THREE.Vector3(vector[m].x - vector[n].x, vector[m].y - vector[n].y, vector[m].z - vector[n].z);
          if (mod.length() <= 20) {
              alert(m + "," + n + " crashed");
          }

  }


  function animate(){

    renderer.clear();
    renderer.render(scene,camera);
    controls.update();

      for(var i = 0; i < Group.length; i++) {
          sx[i] += parseInt(12 * Math.random() - 6);
          sy[i] += parseInt(12 * Math.random() - 6);
          sz[i] += parseInt(12 * Math.random() - 6);
          rx[i] += (0.4 * Math.random() - 0.2);
          ry[i] += (0.4 * Math.random() - 0.2);
          rz[i] += (0.4 * Math.random() - 0.2);

          Group[i].rotation.set(rx[i], ry[i], rz[i]);
          Group[i].position.set(sx[i], sy[i], sz[i]);

          vector[2 * i].getPositionFromMatrix(sphere[2 * i].matrixWorld);

          vector[2 * i + 1].getPositionFromMatrix(sphere[2 * i + 1].matrixWorld);

          if(Group.length > 1) {
                  for(var j = i; j < Group.length - 1; j++) {
                      collisionDetection(2 * i, 2 * j + 2);
                      collisionDetection(2 * i, 2 * j + 3);
                      collisionDetection(2 * i + 1, 2 * j + 2);
                      collisionDetection(2 * i + 1, 2 * j + 3);
                  }

          }
      }

      requestAnimationFrame(animate);
        
  }






  function threeStart() {
    initThree();
    initCamera();
    initScene();   
    initLight();
    initObject();
    animate();

  }






</script>
</head>
 
<body onload="threeStart();">
<div id="canvas-frame"></div>
</body>
</html></span>